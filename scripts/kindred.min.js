import{createApp}from"/helpers/vue.esm-browser.prod.js";import{loadGameplayModules}from"../constants/gameplay.js";import{version}from"/constants/version.js";async function loadHelpers(){const{SaveData:e,GetData:t,RemoveData:a,ClearStore:s}=await import(`../helpers/db-helper.min.js?${version}`);return{SaveData:e,GetData:t,RemoveData:a,ClearStore:s}}async function LoadAllModules(){const e=await loadGameplayModules();return{...await loadHelpers(version),...e}}LoadAllModules().then((e=>{note("Modules loaded");const t=createApp({data:()=>({serviceWorker:"",storedVersion:0,currentVersion:version,deviceHasTouch:!0,allPlayerRanks:e.AllPlayerRanks,currency:new e.Currency,timeToMidnight:"24h 0m 0s",isGettingDailyChallenge:!1,getDailyTimeThreshold:864e5,isInNativeAppWebView:!1,wallpaperNames:["square","circle","triangle","hexagon"],splashBoard:!1,currentWallpaper:"",newVersionAvailable:!1,appTutorialUserHasSeen:!1,appTutorialCurrentStepIndex:0,appTutorialSteps:e.TutorialSteps,appTutorialBoardPieces:e.ConstructLevel("010013110020010303112100220221213211102001200313120",!0),appTutorialIsInPlay:!1,appTutorialMePiece:new e.PieceModel({color:"var(--color2)"}),appNotificationMessage:"",appSettingsAddBonusToScoreInterval:null,appSettingsModes:e.Modes,appSettingsEnableEconomy:!0,appSettingsCurrentGameMode:null,appSettingsInfiniteMode:null,appIsBeingReset:!1,appSettingsSoundFX:new Howl({src:"./audio/phts.mp3",volume:.05}),appSettingsWinFX:new Howl({src:"./audio/triumph.mp3",volume:.05}),appSettingsLevelUpFX:new Howl({src:"./audio/levelup.mp3",volume:.07}),appSettingsSadFX:new Howl({src:"./audio/sadsound.mp3",volume:.1}),userSettingsMusicVolume:.15,appSettingsThemeSong:new Howl({src:"./audio/themesong.m4a",volume:0,loop:!0,id:"theme"}),appSettingsHardcoreEmoji:"ðŸ¤¯",appSettingsHardcoreFinishedEmoji:"ðŸ¤¯",appSettingsSaveSettings:!0,appSettingsModeIntervalIncrement:100,appSettingsNumberOfHighScoresShown:5,appSettingsPieceSize:10,appSettingsScoreTwinIncrement:10,appSettingsScoreSiblingIncrement:20,appSettingsShowSimpleRankPlaques:!1,appSettingsThemes:e.Themes,appSettingsTotalNumberOfBoardPieces:16,appSettingsBoardGridSize:4,appVisualStateShowPageHighScores:!1,appVisualStateShowPageChallenge:!1,appVisualStateShowPageCredits:!1,appVisualStateShowPageGameOver:!1,appVisualStateShowPageHome:!0,appVisualStateShowPageOOBE:!1,appVisualStateShowPageHowToPlay:!1,appVisualStateShowPageAchievements:!1,appVisualStateShowPageSettings:!1,appVisualStateShowPageManageCurrency:!1,appVisualStateShowGameOverContent:!0,appVisualStateShowElementHint:!1,appVisualStateShowNotification:!1,appVisualStateShowElementFlyaway:!1,appVisualStateShowNewHighScoreElement:!1,appVisualStateIsAddingBonusTime:!1,appVisualStateIsLoading:!1,appVisualStateAllConfetti:[],gameConfettiCount:0,gameCurrentIsPaused:!0,gameCurrentIsGameOver:!0,gameDailyChallenge:new e.AllLevelsModel({}),gameCurrentIsGameDailyChallenge:!1,gameDailyChallengeAlreadyScored:!1,gameDailyChallengeHasBeenStarted:!1,gameCurrentAllLevels:[],gameCurrentUpdatedCurrencyDeltas:[],gameCurrentLevel:new e.SingleLevelModel({}),gameCurrentMePiece:{shape:"square"},gameCurrentBoardPieces:[],gameCurrentJustRankedUp:!1,gameCurrentBoardScore:0,gameCurrentTotalScore:0,gameLastHighScore:new e.ScoreModel({}),gameScoreToShare:new e.ScoreModel({}),gameCurrentStartingTime:61e3,gameCurrentTimer:61e3,gameCurrentNumberOfClears:0,gameCurrentNumberOfPerfectMatches:0,gameCurrentIsUserGuessWrong:!1,gameCurrentNumberOfFails:0,gameCurrentNumberOfMisses:0,gameCurrentHasBonusTimeHintDisplayed:!1,gameCurrentHintText:"Select cats that share <b>at least 2</b> of my attributes: color, shape, or pattern.",gameCurrentHasAnyPieceEverBeenSelected:!1,gameLikenessNudgeHasBeenShown:!1,gameClickMeNudgeHasBeenShown:!1,userSettingsUseCats:!0,userDailyLevel:0,userHighScoresInfinite:[],userHighScoresEasy:[],userRank:0,userNumberOfPerfectBasicGames:0,tempPerfectBasicGames:0,userSettingsActionItems:e.ActionItems,userSettingsUseAltPatterns:!0,userSettingsUseHints:!0,userSettingsUseSoundFX:!0,userSettingsPlayMusic:!0,userSettingsUseDarkMode:!1,userCurrency:e.Currencies,userSettingsUseHardCoreMode:!1,usersModeBeforeDailyChallenge:null,userTutorialCheckCount:0,documentCssRoot:document.querySelector(":root")}),methods:{NewGame(){note("NewGame() called"),this.gameCurrentAllLevels=[],this.NewBoard(),this.userHighScoresEasy.forEach((e=>{e.isCurrent=!1})),this.userHighScoresInfinite.forEach((e=>{e.isCurrent=!1})),this.gameCurrentUpdatedCurrencyDeltas=0,this.appVisualStateShowNewHighScoreElement=!1,this.tempPerfectBasicGames=this.userNumberOfPerfectBasicGames,this.gameCurrentTotalScore=0,this.gameCurrentIsGameOver=!1},async ResetApp(){note("NewGame() called"),window.confirm("Are you sure you want to reset the entire game? Everything will be lost!")&&(this.appIsBeingReset=!0,await e.ClearStore(),this.gameDailyChallenge=new e.AllLevelsModel({}),this.gameCurrentIsGameDailyChallenge=!1,this.gameDailyChallengeAlreadyScored=!1,this.gameDailyChallengeHasBeenStarted=!1,this.appTutorialUserHasSeen=!0,e.SaveData("appTutorialUserHasSeen",this.appTutorialUserHasSeen),window.location.reload())},CheckBoard(){note("CheckBoard() called"),this.appVisualStateShowElementHint=!1,this.gameCurrentIsUserGuessWrong=!1;let e=0,a=0;if(this.gameClickMeNudgeHasBeenShown=!0,!this.gameCurrentIsGameOver){let s=!0;this.gameCurrentBoardPieces.forEach((t=>{(t.isMatch&&!t.isSelected||!t.isMatch&&t.isSelected)&&(s=!1),t.isMatch&&(e++,t.isFullMatch?a+=this.appSettingsScoreTwinIncrement:a+=this.appSettingsScoreSiblingIncrement)})),0==e&&(a=this.appSettingsScoreTwinIncrement+this.appSettingsScoreSiblingIncrement),s?(this.gameLikenessNudgeHasBeenShown=!0,this.gameCurrentTotalScore=this.gameCurrentTotalScore+a,this.appVisualStateShowElementHint=!1,this.gameCurrentHasAnyPieceEverBeenSelected=!0,0!==this.gameCurrentNumberOfMisses||this.GetModeById("infinite").isSelected||(this.gameCurrentNumberOfPerfectMatches++,this.AddTimeBonus()),this.gameCurrentNumberOfClears++,this.gameCurrentLevel.completed=!0,this.NewBoard()):this.appSettingsEnableEconomy&&this.userSettingsActionItems[0].count>0?(this.IdentifyMismatches(),this.userSettingsActionItems[0].count--):(this.gameCurrentNumberOfMisses>=1&&(this.appVisualStateShowElementHint=!0,this.gameCurrentHintText=0===e?"Some levels have zero matches.":1===e?"There is only <b>"+e+"</b> cat like me.":"There are a total of <b>"+e+"</b> cats like me.",this.userSettingsUseHints&&this.IdentifyMismatches()),this.gameCurrentNumberOfMisses++,this.gameCurrentNumberOfFails++,window.setTimeout((function(){t.gameCurrentIsUserGuessWrong=!0}),5))}},RemoveConfetti(){note("RemoveConfetti() called"),this.appVisualStateAllConfetti=[]},CreateConfetti(e=null,t=null){note("CreateConfetti() called"),this.RemoveConfetti(),requestAnimationFrame((()=>{t=null===t?this.userRank:t;let a=document.getElementsByTagName("app")[0],s=a.clientWidth,r=t!==this.getLastRank.rank;null!==t&&t===this.getLastRank.rank&&(r=!1);for(let t=0;t<s;t++){let t={l:"0px",td:"0ms",tdly:"0ms",bc:"none",r:"0deg",w:0,h:0,tl:"0px 0px",cn:""},s=r?this.getCurrentPlayerRank.hue:getRandomInt(0,360);null!==e&&r&&(s=e);let i=r?getRandomInt(50,100):60;t.l=getRandomInt(0,a.clientWidth)+(window.innerWidth-a.clientWidth)/2+"px",t.td=getRandomInt(1600,3001)+"ms",t.tdly=getRandomInt(0,800)+"ms",t.bc="hsl("+s+",80%, "+i+"%)",t.r=NaN;let n=getRandomInt(40,100)/10,l=getRandomInt(40,100)/10;t.w=n,t.h=l,this.appVisualStateAllConfetti.push(t)}setTimeout((()=>{this.appVisualStateAllConfetti.forEach((e=>{document.getElementById("confetti");e.tl=parseInt(getRandomInt(-20,20))+"px "+parseInt(document.body.clientHeight-e.h+20)+"px",e.r=getRandomInt(-360,360)+"deg",e.cn="drop"}))}),this.appVisualStateShowPageGameOver?300:10)}))},async SetUserBasedOnRank(t,a=!1){note("SetUserBasedOnRank() called"),this.userRank=t;let s=this.allPlayerRanks.find((e=>e.rank===t));this.documentCssRoot.style.setProperty("--rankHue",s.hue),a&&(this.CreateConfetti(),this.GetDailyChallenge()),await e.SaveData("userRank",this.userRank)},CalculateDailyChallengeTotalScore(){note("CalculateDailyChallengeTotalScore() called");let e=0;return this.gameDailyChallenge.allLevels.forEach(((t,a)=>{let s=0,r=0;t.board.forEach(((e,t)=>{e.isMatch&&(r++,e.isFullMatch?s+=this.appSettingsScoreTwinIncrement:s+=this.appSettingsScoreSiblingIncrement)})),0===r&&(s=this.appSettingsScoreTwinIncrement+this.appSettingsScoreSiblingIncrement),e+=s})),e},NewBoard(){note("NewBoard() called"),this.AdjustPieceSizeBasedOnViewport(),this.gameCurrentBoardScore=0,this.gameCurrentNumberOfMisses=0;let t=null;this.gameDailyChallengeHasBeenStarted&&this.gameDailyChallenge.allLevels.forEach(((e,a)=>{null!==t||e.completed||(error(a),t=e)}));let a="infinite"!==this.GetCurrentGameMode().id&&this.gameCurrentAllLevels.length===this.getCurrentPlayerRank.levels;a||(this.gameCurrentBoardPieces=[]),null===t&&a?this.EndGame():(null===t&&(t=e.ConstructLevel(e.CreateLevelSource(),!0)),this.gameCurrentMePiece=t.me,this.gameCurrentLevel=t,this.gameCurrentAllLevels.push(this.gameCurrentLevel),this.userSettingsUseSoundFX&&(this.appSettingsSoundFX.volume(.05),setTimeout((()=>{this.appSettingsSoundFX.play()}),236)),t.board.forEach(((e,a)=>{e.delay=40*(t.board.length-a),this.gameCurrentBoardPieces.push(e),window.setTimeout((function(){e.hasDropped=!0}),e.delay)})))},TogglePieceSelection(e){if(note('TogglePieceSelection() called for: " this.gameCurrentBoardPieces['+this.gameCurrentBoardPieces.indexOf(e)+']"'),this.appVisualStateShowElementHint=!1,e.nudge=!1,!this.gameLikenessNudgeHasBeenShown){let t=0;t=e.color===this.gameCurrentMePiece.color?parseInt(t+1):t,t=e.backgroundImage===this.gameCurrentMePiece.backgroundImage?parseInt(t+1):t,t=e.shape===this.gameCurrentMePiece.shape?parseInt(t+1):t,t<2&&(this.appVisualStateShowElementHint=!0,this.gameCurrentHintText="Select cats that share <b>at least 2</b> of my attributes: color, shape, or pattern."),this.gameLikenessNudgeHasBeenShown=!0}null!=navigator.vibrate&&navigator.vibrate(100),this.gameCurrentIsGameOver||(e.isSelected=!e.isSelected,this.gameCurrentHasAnyPieceEverBeenSelected=!0)},ShareApp(){let e={title:"Kindred Cats!",text:"Check out this fun game I've been playing!",url:"https://bigtentgames.com/kindred.html"};navigator.share?navigator.share(e):(e="https://bigtentgames.com/kindred.html",this.appVisualStateShowNotification=!0,this.appNotificationMessage="Copied game link to the clipboard.",navigator.clipboard.writeText(e))},SetScoreForSharingAndShare(e,a,s=!1){note("SetScoreForSharingAndShare() called"),this.appVisualStateIsAddingBonusTime||(this.appVisualStateShowNotification=!1,""===e.modeId&&(e.modeId=a.id,e.modeName=a.name,e.numberOfPerfectClears=this.gameCurrentNumberOfPerfectMatches),this.gameScoreToShare=e,this.appVisualStateShowNotification?window.setTimeout((function(){t.ShareScore(s)}),200):t.ShareScore(s))},ShareScore(e=!1){note("ShareScored() called");let t=["â–¨ ","â–² ","â—¯ "].sort((()=>Math.random()-.5)).join(""),a=this.userSettingsUseHardCoreMode?"Hardcore Mode":this.gameScoreToShare.modeName,s=`${t}${this.gameScoreToShare.isDaily?"Daily - "+this.GetMonthAndDay(this.gameScoreToShare.dailyDate):a}\n${e?"I just unlocked "+this.getCurrentPlayerRank.name+"!":'"'+this.GetRankById(this.gameScoreToShare.rankId).name+'"'}\n${this.NumberWithCommas(this.gameScoreToShare.value)} pts - ${this.gameScoreToShare.numberOfClears} lvl${1===this.gameScoreToShare.numberOfClears?"":"s"} ${this.gameScoreToShare.numberOfPerfectClears>0?"("+this.gameScoreToShare.numberOfPerfectClears+" perfect)":""}`;if(navigator.share){let e={text:s};navigator.share(e)}else this.appVisualStateShowNotification=!0,this.appNotificationMessage=this.gameLastHighScore.isDaily?"Daily challenge results copied to the clipboard.":"Game results copied to the clipboard.",navigator.clipboard.writeText(s)},GiveFeedback(){window.location="mailto:bigtentgames@icloud.com?subject=Feedback - Kindred Cats v"+this.currentVersion},RestartGame(){note("RestartGame() called"),this.gameCurrentStartingTime=this.appSettingsCurrentGameMode.starttime,this.gameCurrentTimer=this.GetModeById("infinite").isSelected?0:this.gameCurrentStartingTime,this.gameCurrentNumberOfFails=0,this.gameCurrentNumberOfClears=0,this.gameCurrentNumberOfPerfectMatches=0,this.appVisualStateShowNotification=!1,this.appVisualStateShowPageHome=!1,this.appVisualStateShowPageGameOver=!1,this.appVisualStateShowElementHint=!1,this.gameCurrentIsPaused=!1,this.gameCurrentHintText="Select cats that share <b>at least two</b> of my attributes (color, shape, pattern).",this.gameCurrentHasAnyPieceEverBeenSelected=!1,this.NewGame()},SelectMode(e){note('SelectMode(mode) called for:  "'+e.name+'"'),this.gameCurrentBoardPieces=[],this.appSettingsModes.forEach((t=>{t.isSelected=e===t})),this.appSettingsCurrentGameMode=e},GetCurrentGameMode(){note("GetCurrentGameMode() called");let e=null;return this.appSettingsModes.forEach((t=>{t.isSelected&&(e=t)})),null===e&&(this.SelectMode(this.GetModeById("normal")),e=this.appSettingsCurrentGameMode),e},GetModeById(e){note('GetModeById(_id) called for: "'+e+'"');let t={name:"no name"};if(this.appSettingsModes.forEach((a=>{a.id===e&&(t=a)})),null!=t)return t},GetRankById(e){return this.allPlayerRanks.find((t=>t.rank===e))},async SelectTheme(t){note('SelectTheme(theme) called for: "'+t.name+'"'),this.appSettingsThemes.forEach((e=>{e.isSelected=t==e})),this.documentCssRoot.style.setProperty("--color1",t.color1),this.documentCssRoot.style.setProperty("--color2",t.color2),this.documentCssRoot.style.setProperty("--color3",t.color3),this.documentCssRoot.style.setProperty("--color3contrast",t.color3contrast),this.userSettingsUseDarkMode||this.documentCssRoot.style.setProperty("--patternHSL","0, 0%, 100%"),this.GetRandomWallpaper(),await e.SaveData("userSettingsTheme",JSON.stringify(t.name))},GetCurrentTheme(){return note("GetCurrentTheme() called"),this.appSettingsThemes.filter((e=>e.isSelected))[0]},UpdateApp(){this.appVisualStateShowPageHome&&(this.timeToMidnight=this.GetTimeUntilMidnight(),this.GetTimeUntilMidnightInMS()<this.getDailyTimeThreshold&&this.GetTimeUntilMidnightInMS()>this.getDailyTimeThreshold-1e3&&this.GetDailyChallenge()),this.gameCurrentIsPaused||this.appVisualStateShowPageGameOver||(0===this.gameCurrentNumberOfClears&&0===this.userHighScoresEasy.length&&(this.appSettingsInfiniteMode.isSelected||this.gameLikenessNudgeHasBeenShown||this.appSettingsCurrentGameMode.starttime-this.gameCurrentTimer!=7e3?this.appSettingsInfiniteMode.isSelected&&!this.gameLikenessNudgeHasBeenShown&&7e3===this.gameCurrentTimer&&(this.appVisualStateShowElementHint=!0,this.gameCurrentHintText="Select cats that share <b>at least 2</b> of my attributes: color, shape, or pattern.",this.gameLikenessNudgeHasBeenShown=!0):(this.appVisualStateShowElementHint=!0,this.gameCurrentHintText="Select cats that share <b>at least 2</b> of my attributes: color, shape, or pattern.",this.gameLikenessNudgeHasBeenShown=!0),(!this.appSettingsInfiniteMode.isSelected&&!this.appVisualStateShowElementHint&&!this.gameClickMeNudgeHasBeenShown&&this.appSettingsCurrentGameMode.starttime-this.gameCurrentTimer>=25e3&&this.gameCurrentTimer%1e3==0||this.appSettingsInfiniteMode.isSelected&&!this.appVisualStateShowElementHint&&!this.gameClickMeNudgeHasBeenShown&&this.gameCurrentTimer>=25e3&&this.gameCurrentTimer%1e4==0)&&(this.appVisualStateShowElementHint=!0,this.gameCurrentHintText="Remember to click the me cat to check your work and move to the next level.",this.gameClickMeNudgeHasBeenShown=!0)),this.gameCurrentTimer>0||this.appSettingsInfiniteMode.isSelected&&!this.gameCurrentIsGameOver?this.appSettingsInfiniteMode.isSelected?this.gameCurrentTimer=parseInt(this.gameCurrentTimer)+parseInt(this.appSettingsModeIntervalIncrement):this.gameCurrentTimer=this.gameCurrentTimer-this.appSettingsModeIntervalIncrement:this.gameCurrentIsGameOver||this.EndGame())},GetMsToTime(e){var t=(e=(e-e%1e3)/1e3)%60,a=(e=(e-t)/60)%60,s=(e-a)/60;return(0!=s?s+":":"")+(0!=a?a:"")+(":"+("0"+t).slice(-2))},GetMsToHMS(e){var t=(e-e%1e3)/1e3,a=t%60,s=(t=(t-a)/60)%60,r=(t-s)/60;return(0!=r?r+"h ":"")+(0!=s?s+"m ":"")+(a+"s")},DateDiffInDays:(e=new Date,t=new Date("7/30/2023"))=>(_number=Math.round((e-t)/864e5),_number),GetTimeUntilMidnightInMS(){var e=new Date;return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1,0,0,0)-e},GetTimeUntilMidnight(){return this.GetMsToHMS(this.GetTimeUntilMidnightInMS())},AwardCurrency(){if(note("AwardCurrency() called"),this.appSettingsEnableEconomy&&(this.gameCurrentUpdatedCurrencyDeltas=[],this.appSettingsEnableEconomy&&this.getNormalModeComputed.isSelected)){let e=0;this.gameCurrentNumberOfClears===this.getCurrentPlayerRank.levels&&(e+=1e3);for(let t=0;t<this.gameCurrentNumberOfClears;t++)e+=10;this.gameCurrentUpdatedCurrencyDeltas.push({currency:this.userCurrency[0],delta:e}),this.userCurrency[0].count=this.userCurrency[0].count+e,this.userCurrency[0].count>this.userCurrency[0].maxCount&&(this.userCurrency[0].count,this.userCurrency[0].maxCount)}},async EndGame(){note("EndGame() called");let t=new e.ScoreModel({value:this.gameCurrentTotalScore,isDaily:this.gameCurrentIsGameDailyChallenge,modeId:this.GetCurrentGameMode().id,rankId:this.getCurrentPlayerRank.rank,modeName:this.GetCurrentGameMode().name,numberOfClears:this.gameCurrentNumberOfClears});if(this.appVisualStateShowPageGameOver=!0,this.AwardCurrency(),this.getNormalModeComputed.isSelected){if(t.totalPossibleClears=this.getCurrentPlayerRank.levels,t.numberOfPerfectClears=this.gameCurrentNumberOfPerfectMatches,t.numberOfPerfectClears===t.totalPossibleClears){this.userNumberOfPerfectBasicGames++,this.tempPerfectBasicGames=this.userNumberOfPerfectBasicGames;let e=3;this.CreateConfetti(),this.userSettingsUseSoundFX&&(this.appSettingsWinFX.volume(.05),this.appSettingsWinFX.play()),this.userNumberOfPerfectBasicGames===e&&(this.getCurrentPlayerRank!==this.getLastRank&&(this.userRank=this.userRank+1,this.SetUserBasedOnRank(this.userRank,!0),this.userNumberOfPerfectBasicGames=0),this.userSettingsUseSoundFX&&(this.appSettingsLevelUpFX.volume(.075),this.appSettingsLevelUpFX.play()),this.gameCurrentJustRankedUp=!0)}else this.userSettingsUseHardCoreMode&&this.userNumberOfPerfectBasicGames<3&&(this.userNumberOfPerfectBasicGames=0,t.numberOfPerfectClears=0,this.tempPerfectBasicGames=0);t.numberOfPerfectClears!==t.totalPossibleClears&&this.userSettingsUseSoundFX&&(this.appSettingsSadFX.volume(.1),this.appSettingsSadFX.play())}this.gameCurrentIsGameDailyChallenge&&(t.dailyDate=this.gameDailyChallenge.date),this.GetModeById("normal").isSelected?(this.userHighScoresEasy.push(t),t===this.userScoresHighEasyByValue[0]&&0!==t.value&&(this.appVisualStateShowNewHighScoreElement=!0)):this.GetModeById("infinite").isSelected&&this.userHighScoresInfinite.push(t),t.isCurrent=!0,this.gameLastHighScore=t,this.gameScoreToShare=this.gameLastHighScore,this.AddBonusToScore(),this.gameCurrentLevel.completed=!0,this.gameCurrentIsGameDailyChallenge=!1,this.GetDailyChallenge(),this.CheckForServiceWorkerUpdate(),this.gameCurrentIsGameOver=!0,this.gameDailyChallengeHasBeenStarted=!1,this.appVisualStateShowPageChallenge=!1,this.HandleOnPageHideEvent(!1),await e.SaveData("userRank",this.userRank),await e.SaveData("userNumberOfPerfectBasicGames",this.userNumberOfPerfectBasicGames),await e.SaveData("userHighScoresEasy",JSON.stringify(this.userHighScoresEasy)),await e.SaveData("userHighScoresInfinite",JSON.stringify(this.userHighScoresInfinite))},SetState(){this.gameCurrentTimer=3e3},HandleAddBonusToScoreInterval(){let e=1e3/(this.gameCurrentTimer/1e3);e=e>100?100:e,this.appVisualStateIsAddingBonusTime=!0,this.appSettingsAddBonusToScoreInterval=window.setInterval((function(){t.gameCurrentTimer>0?(t.gameCurrentTotalScore++,t.gameLastHighScore.value=t.gameCurrentTotalScore,t.gameCurrentTimer=t.gameCurrentTimer-1e3):(t.gameLastHighScore===t.userScoresHighEasyByValue[0]&&(t.appVisualStateShowNewHighScoreElement=!0),this.SaveUserHighScoreEasy(),window.clearInterval(t.appSettingsAddBonusToScoreInterval),t.appVisualStateIsAddingBonusTime=!1)}),e)},async SaveUserHighScoreEasy(){note("SaveUserHighScoreEasy() called"),await e.SaveData("userHighScoresEasy",JSON.stringify(t.userHighScoresEasy))},AddBonusToScore(){note("AddBonusToScore() called"),this.gameCurrentTimer>0&&this.gameLastHighScore.isDaily&&this.gameCurrentNumberOfClears===this.gameDailyChallenge.allLevels.length&&(this.appVisualStateIsAddingBonusTime=!0,window.setTimeout(this.HandleAddBonusToScoreInterval,1e3))},CheckIfUserHasScoredDailyChallenge(){warn("CheckIfUserHasScoredDailyChallenge() called"),this.gameDailyChallengeAlreadyScored=!1;const e=new Date;return this.userHighScoresEasy.forEach((t=>{t.isDaily&&void 0!==t.dailyDate&&this.IsSameDay(t.dailyDate,e)&&(this.gameDailyChallengeAlreadyScored=!0)})),this.gameDailyChallengeAlreadyScored},IsSameDay:(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),ToggleZenMode(){note("ToggleZenMode() called"),this.getCurrentGameModeComputed===this.getInfiniteModeComputed?this.SelectMode(this.getNormalModeComputed):this.SelectMode(this.getInfiniteModeComputed)},async SetUseHardCoreModeToTrue(t){if(note("SetUseHardCoreModeToTrue(event) called"),!this.userSettingsUseHardCoreMode){window.confirm("Are you sure you want to enable Hardcore Mode? This will reset your ranks and cannot be undone.")&&(void 0!==t&&(t.stopPropagation(),t.preventDefault()),this.userSettingsUseHardCoreMode=!0,this.SetUserBasedOnRank(0),this.userNumberOfPerfectBasicGames=0,this.CreateConfetti()),await e.SaveData("userSettingsUseHardCoreMode",this.userSettingsUseHardCoreMode)}},async SetUseHardCoreModeToFalse(){note("SetUseHardCoreModeToFalse(event) called"),this.userSettingsUseHardCoreMode=!1,this.userNumberOfPerfectBasicGames=0,this.SetUserBasedOnRank(0),await e.SaveData("userSettingsUseHardCoreMode",this.userSettingsUseHardCoreMode)},async ToggleUsingHints(t){note("ToggleUsingHints(event) called"),void 0!==t&&(t.stopPropagation(),t.preventDefault()),this.userSettingsUseHints=!this.userSettingsUseHints,this.userSettingsUseHints||this.gameCurrentBoardPieces.forEach((e=>{e.nudge=!1})),await e.SaveData("userSettingsUseHints",this.userSettingsUseHints)},async ToggleUsingCats(t){note("ToggleUsingCats(event) called"),null!=t&&(t.stopPropagation(),t.preventDefault()),this.userSettingsUseCats=!this.userSettingsUseCats,this.GetRandomWallpaper(),await e.SaveData("userSettingsUseCats",this.userSettingsUseCats)},async ToggleUsingAltPattern(t){note("ToggleUsingAltPattern(event) called"),null!=t&&(t.stopPropagation(),t.preventDefault()),this.userSettingsUseAltPatterns=!this.userSettingsUseAltPatterns,await e.SaveData("userSettingsUseAltPatterns",this.userSettingsUseAltPatterns)},async ToggleUsingSound(t){note("ToggleUsingSound(event) called"),void 0!==t&&(t.stopPropagation(),t.preventDefault()),this.userSettingsUseSoundFX=!this.userSettingsUseSoundFX,await e.SaveData("userSettingsUseSoundFX",this.userSettingsUseSoundFX)},async TogglePlayingMusic(t){note("TogglePlayingMusic(event) called"),void 0!==t&&(t.stopPropagation(),t.preventDefault()),this.userSettingsPlayMusic=!this.userSettingsPlayMusic,this.appSettingsThemeSong.playing()||"loaded"!==this.appSettingsThemeSong.state()||this.appSettingsThemeSong.play(),this.userSettingsPlayMusic?this.appSettingsThemeSong.fade(0,this.userSettingsMusicVolume,1e3):this.appSettingsThemeSong.fade(this.userSettingsMusicVolume,0,1e3),await e.SaveData("userSettingsPlayMusic",this.userSettingsPlayMusic)},async ToggleUsingDarkMode(t){note("ToggleUsingDarkMode(event) called"),null!=t&&(t.stopPropagation(),t.preventDefault()),this.userSettingsUseDarkMode=!this.userSettingsUseDarkMode,this.SelectTheme(this.GetCurrentTheme()),document.getElementById("themeColor").content=this.userSettingsUseDarkMode?"#000000":"#f0f0f0",await e.SaveData("userSettingsUseDarkMode",this.userSettingsUseDarkMode)},async ToggleGamePause(t,a){note("ToggleGamePause(event, "+a+") called"),null!=t&&(t.stopPropagation(),t.preventDefault()),this.gameCurrentIsPaused=a,await e.SaveData("gameCurrentIsPaused",this.gameCurrentIsPaused)},ResetModalContentScrollPositions(){note("ResetModalContentScrollPositions() called");let e=document.getElementsByTagName("content");for(let t=0;t<e.length;t++){e[t].scroll({top:0})}},ToggleChallenge(e,t){note("ToggleChallenge(event, value) called"),null!=e&&(e.stopPropagation(),e.preventDefault()),this.ResetModalContentScrollPositions(),this.appVisualStateShowPageChallenge=t},ToggleShowStoreOn(e){note("ToggleShowHomeOn(event) called"),this.appSettingsEnableEconomy&&(void 0!==e&&(e.stopPropagation(),e.preventDefault()),this.appVisualStateShowPageManageCurrency=!this.appVisualStateShowPageManageCurrency)},ToggleShowHomeOn(e){note("ToggleShowHomeOn(event) called"),void 0!==e&&(e.stopPropagation(),e.preventDefault()),this.RemoveConfetti(),this.appVisualStateShowPageGameOver=!1,this.appVisualStateShowPageHome=!0,null!==this.usersModeBeforeDailyChallenge&&(this.SelectMode(this.usersModeBeforeDailyChallenge),this.usersModeBeforeDailyChallenge=null),this.gameCurrentJustRankedUp&&this.getCurrentPlayerRank===this.getLastRank&&this.userNumberOfPerfectBasicGames>=3&&this.ToggleAchievements(e,!0),this.gameCurrentJustRankedUp=!1},ToggleHowToPlay(e,t){note("ToggleHowToPlay(event, value) called"),void 0!==e&&(e.stopPropagation(),e.preventDefault()),this.ResetModalContentScrollPositions(),this.appTutorialIsInPlay=!0},ToggleOOBE(e,t){note("ToggleOOBE(event, value) called"),null!=e&&(e.stopPropagation(),e.preventDefault()),this.ResetModalContentScrollPositions(),this.appVisualStateShowPageOOBE=t},ToggleHighScores(e,t){note("ToggleHighScores(event, value) called"),void 0!==e&&(e.stopPropagation(),e.preventDefault()),this.ResetModalContentScrollPositions(),this.appVisualStateShowPageGameOver=!1,this.appVisualStateShowPageHome=!0,this.appVisualStateShowPageHighScores=t},ToggleAchievements(e,t){note("ToggleAchievements(event, value) called"),null!=e&&(e.stopPropagation(),e.preventDefault()),this.ResetModalContentScrollPositions(),this.appVisualStateShowPageGameOver=!1,this.appVisualStateShowPageHome=!0,this.appVisualStateShowPageAchievements=t},ToggleSettings(e,t){note("ToggleSettings(event, "+t+") called"),void 0!==e&&(e.stopPropagation(),e.preventDefault()),this.ResetModalContentScrollPositions(),this.appVisualStateShowPageSettings=t,this.ToggleGamePause(e,t)},ToggleCredits(e,t){note("ToggleCredits(event, value) called"),void 0!==e&&(e.stopPropagation(),e.preventDefault()),this.ResetModalContentScrollPositions(),this.appVisualStateShowPageCredits=t},async GetUserSettings(){note("GetUserSettings() called");let t=await e.GetData("appSettingsModes");null!=t&&(t=JSON.parse(t),null!=t.easy&&null!=t.easy?(this.GetModeById("normal").isSelected=t.infinite.isSelected,this.GetModeById("normal").isSelected=t.easy.isSelected):t.forEach((e=>{this.appSettingsModes.forEach((t=>{t.id===e.id&&(t.isSelected=e.isSelected)}))})));let a=await e.GetData("appTutorialUserHasSeen");note("setting OOBE tutorial based on local storage"),null!=a?(a=JSON.parse(a),a?this.appTutorialUserHasSeen=!0:this.ToggleHowToPlay()):this.ToggleHowToPlay();let s=await e.GetData("userRank");note("setting userRank from local storage"),null!=s&&"undefined"!==s?this.SetUserBasedOnRank(parseInt(s)):this.SetUserBasedOnRank(0);let r=await e.GetData("userSettingsUseHardCoreMode");null!=r&&(this.userSettingsUseHardCoreMode=JSON.parse(r));let i=await e.GetData("userNumberOfPerfectBasicGames");null!=i&&(i=JSON.parse(i),this.userNumberOfPerfectBasicGames=i);let n=await e.GetData("userSettingsUseHints");null!=n&&(n=JSON.parse(n),this.userSettingsUseHints=n);let l=await e.GetData("userSettingsUseCats");null!=l&&(l=JSON.parse(l),this.userSettingsUseCats=l);let o=await e.GetData("userSettingsUseAltPatterns");null!=o&&(o=JSON.parse(o),this.userSettingsUseAltPatterns=o);let h=await e.GetData("userSettingsUseSoundFX");null!=h&&(h=JSON.parse(h),this.userSettingsUseSoundFX=h);let u=await e.GetData("userSettingsPlayMusic");null!=u&&(u=JSON.parse(u),this.userSettingsPlayMusic=u);let g=await e.GetData("userSettingsUseDarkMode");null!=g&&(g=JSON.parse(g),this.userSettingsUseDarkMode=g),document.getElementById("themeColor").content=this.userSettingsUseDarkMode?"#000000":"#f0f0f0";let c=await e.GetData("userSettingsTheme");try{let e="";null!=c&&(c=JSON.parse(c),this.appSettingsThemes.forEach((t=>{t.name==c&&(e=t)}))),""!=e?this.SelectTheme(e):this.SelectTheme(this.appSettingsThemes[0])}catch(e){error("_userSettingsTheme error: "+e),_gameDataCorrupt=!0}let m=await e.GetData("userHighScoresEasy");try{null!=m&&"[]"!==m&&(m=JSON.parse(m),m.forEach((t=>{this.userHighScoresEasy.push(new e.ScoreModel({modeId:null==t.modeId?"":t.modeId,modeName:null==t.modeName?"":t.modeName,streak:null==t.streak?0:t.streak,numberOfClears:null==t.numberOfClears?0:t.numberOfClears,numberOfPerfectClears:null==t.numberOfPerfectClears?0:t.numberOfPerfectClears,date:new Date(t.date),isDaily:t.isDaily,rankId:t.rankId,value:t.value,dailyDate:null!=t.dailyDate?new Date(t.dailyDate):new Date(t.date)}))})))}catch(e){error("_userHighScoresEasy error: "+e),_gameDataCorrupt=!0}let S=await e.GetData("gameCurrentHasAnyPieceEverBeenSelected");try{null!=S&&(this.gameCurrentHasAnyPieceEverBeenSelected=JSON.parse(S))}catch(e){error("_gameCurrentHasAnyPieceEverBeenSelected error: "+e),_gameDataCorrupt=!0}let d=await e.GetData("gameLikenessNudgeHasBeenShown");try{null!=d&&(this.gameLikenessNudgeHasBeenShown=!0===JSON.parse(d))}catch(e){error("_gameLikenessNudgeHasBeenShown error: "+e),_gameDataCorrupt=!0}let p=await e.GetData("gameClickMeNudgeHasBeenShown");try{null!=p&&(this.gameClickMeNudgeHasBeenShown=!0===JSON.parse(p))}catch(e){error("_gameClickMeNudgeHasBeenShown error: "+e),_gameDataCorrupt=!0}},async ClearAllUserScores(){note("ClearAllUserScores() called"),window.confirm("Are you sure you want to clear all of your scores?")&&(this.appVisualStateShowNotification=!1,this.gameLastHighScore=new e.ScoreModel({}),this.gameScoreToShare=new e.ScoreModel({}),this.userHighScoresEasy=[],this.userHighScoresInfinite=[],this.gameDailyChallenge.allLevels=[],this.gameCurrentIsGameDailyChallenge=!1,this.userNumberOfPerfectBasicGames=0,this.GetDailyChallenge(),await e.SaveData("userNumberOfPerfectBasicGames",this.userNumberOfPerfectBasicGames),await e.SaveData("userHighScoresEasy",JSON.stringify(this.userHighScoresEasy)),await e.SaveData("userHighScoresInfinite",JSON.stringify(this.userHighScoresInfinite)))},async RestoreCurrentGame(){note("RestoreCurrentGame() called");let t=!1,a=await e.GetData("appSettingsModeIntervalIncrement");try{null!=a&&(this.appSettingsModeIntervalIncrement=a)}catch(e){error("_appSettingsModeIntervalIncrement error: "+e),t=!0}let s=await e.GetData("appSettingsPieceSize");try{null!=s&&(this.appSettingsPieceSize=s)}catch(e){error("_appSettingsPieceSize error: "+e),t=!0}let r=await e.GetData("appSettingsTotalNumberOfBoardPieces");try{null!=r&&(this.appSettingsTotalNumberOfBoardPieces=r)}catch(e){error("_appSettingsTotalNumberOfBoardPieces error: "+e),t=!0}let i=await e.GetData("appSettingsBoardGridSize");try{null!=i&&(this.appSettingsBoardGridSize=i)}catch(e){error("_appSettingsBoardGridSize error: "+e),t=!0}let n=await e.GetData("appVisualStateShowPageHome");try{null!=n&&(this.appVisualStateShowPageHome=JSON.parse(n))}catch(e){error("_appVisualStateShowPageHome error: "+e),t=!0}let l=await e.GetData("appVisualStateShowPageHowToPlay");try{null!=l&&(this.appVisualStateShowPageHowToPlay=JSON.parse(l))}catch(e){error("_appVisualStateShowPageHowToPlay error: "+e),t=!0}let o=await e.GetData("appVisualStateShowPageSettings");try{null!=o&&(this.appVisualStateShowPageSettings=JSON.parse(o))}catch(e){error("_appVisualStateShowPageSettings error: "+e),t=!0}let h=await e.GetData("appVisualStateShowElementHint");try{null!=h&&(this.appVisualStateShowElementHint=JSON.parse(h))}catch(e){error("_appVisualStateShowElementHint error: "+e),t=!0}let u=await e.GetData("appVisualStateShowElementFlyaway");try{null!=u&&(this.appVisualStateShowElementFlyaway=JSON.parse(u))}catch(e){error("_appVisualStateShowElementFlyaway error: "+e),t=!0}let g=await e.GetData("gameCurrentIsPaused");try{null!=g&&(g=JSON.parse(g),this.gameCurrentIsPaused=g)}catch(e){error("_gameCurrentIsPaused error: "+e),t=!0}let c=await e.GetData("gameDailyChallenge");try{null!=c&&(c=JSON.parse(c),_letAllLevels=new e.AllLevelsModel({date:new Date(c.date)}),c.allLevels.forEach((t=>{let a=new e.SingleLevelModel({me:t.me,completed:t.completed});t.board.forEach((t=>{a.board.push(new e.PieceModel(t))})),_letAllLevels.allLevels.push(a)})),this.gameDailyChallenge=_letAllLevels)}catch(e){error("_gameDailyChallenge error: "+e),t=!0}let m=await e.GetData("gameCurrentIsGameDailyChallenge");try{null!=m&&(m=JSON.parse(m),this.gameCurrentIsGameDailyChallenge=m)}catch(e){error("_gameCurrentIsGameDailyChallenge error: "+e),t=!0}let S=await e.GetData("gameDailyChallengeHasBeenStarted");try{null!=S&&(S=JSON.parse(S),this.gameDailyChallengeHasBeenStarted=S)}catch(e){error("_gameDailyChallengeHasBeenStarted error: "+e),t=!0}let d=await e.GetData("gameCurrentAllLevels");try{null!=d&&(d=JSON.parse(d),this.gameCurrentAllLevels=d)}catch(e){error("_gameCurrentAllLevels error: "+e),t=!0}let p=await e.GetData("gameCurrentLevel");try{if(null!=p){p=JSON.parse(p);let t=new e.SingleLevelModel({me:p.me,completed:p.completed});if(this.gameCurrentIsGameDailyChallenge)for(let e=0;e<this.gameDailyChallenge.allLevels.length;e++){const a=this.gameDailyChallenge.allLevels[e];if(!a.completed){t=a;break}}else p.board.forEach((a=>{t.board.push(new e.PieceModel(a))}));this.gameCurrentLevel=t}}catch(e){error("_gameCurrentLevel error: "+e),t=!0}let C=await e.GetData("gameCurrentMePiece");try{null!=C&&(C=JSON.parse(C),this.gameCurrentMePiece=new e.PieceModel(C))}catch(e){error("_gameCurrentMePiece error: "+e),t=!0}let y=await e.GetData("gameCurrentBoardPieces");try{null!=y&&(y=JSON.parse(y),this.gameCurrentBoardPieces=[],y.forEach((t=>{this.gameCurrentBoardPieces.push(new e.PieceModel(t))})))}catch(e){error("_gameCurrentBoardPieces error: "+e),t=!0}let w=await e.GetData("gameCurrentStartingTime");try{null!=w&&(this.gameCurrentStartingTime=w)}catch(e){error("_gameCurrentStartingTime error: "+e),t=!0}let f=await e.GetData("gameCurrentTimer");try{null!=f&&(this.gameCurrentTimer=f)}catch(e){error("_gameCurrentTimer error: "+e),t=!0}let v=await e.GetData("gameCurrentNumberOfClears");try{null!=v&&(this.gameCurrentNumberOfClears=v)}catch(e){error("_gameCurrentNumberOfClears error: "+e),t=!0}let P=await e.GetData("gameCurrentNumberOfPerfectMatches");try{null!=P&&(this.gameCurrentNumberOfPerfectMatches=P)}catch(e){error("_gameCurrentNumberOfPerfectMatches error: "+e),t=!0}let H=await e.GetData("gameCurrentIsUserGuessWrong");try{null!=H&&(this.gameCurrentIsUserGuessWrong=JSON.parse(H))}catch(e){error("_gameCurrentIsUserGuessWrong error: "+e),t=!0}let D=await e.GetData("gameCurrentNumberOfFails");try{null!=D&&(this.gameCurrentNumberOfFails=D)}catch(e){error("_gameCurrentNumberOfFails error: "+e),t=!0}let T=await e.GetData("gameCurrentNumberOfMisses");try{null!=T&&(this.gameCurrentNumberOfMisses=T)}catch(e){error("_gameCurrentNumberOfMisses error: "+e),t=!0}let M=await e.GetData("gameCurrentHintText");try{null!=M&&(this.gameCurrentHintText=M)}catch(e){error("_gameCurrentHintText error: "+e),t=!0}let k=await e.GetData("gameCurrentTotalScore");try{null!=k&&(this.gameCurrentTotalScore=parseInt(k))}catch(e){error("_gameCurrentTotalScore error: "+e),t=!0}this.CheckIfUserHasScoredDailyChallenge(),t&&(this.gameCurrentIsGameOver=!0,this.NewGame())},GetRandomWallpaper(){note("GetRandomWallpaper() called"),this.currentWallpaper=this.wallpaperNames[getRandomInt(0,this.wallpaperNames.length)]},async InitializeGame(){note("Game Initialized"),this.AdjustPieceSizeBasedOnViewport(),this.CheckForMobile(),this.GetRandomWallpaper();let t=await e.GetData("onemoretime");try{null!=t&&(t=JSON.parse(t),t&&await e.SaveData("onemoretime",!1))}catch(e){error("_onemoretime error: "+e)}let a=await e.GetData("storedVersion");try{null!=a&&(this.storedVersion=a)}catch(e){a=null}let s=await e.GetData("userCurrency");try{if(null!=s){let e=JSON.parse(s);this.userCurrency.forEach((t=>{let a=e.find((e=>e.id===t.id));t.count=a.count}))}}catch(e){error("_userCurrency error: "+e)}let r=await e.GetData("userSettingsActionItems");try{if(null!=r){let e=JSON.parse(r);this.userSettingsActionItems.forEach((t=>{let a=e.find((e=>e.id===t.id));t.count=a.count}))}}catch(e){error("_userSettingsActionItems error: "+e)}let i=await e.GetData("gameCurrentIsGameOver");try{null!=i&&(this.gameCurrentIsGameOver=JSON.parse(i))}catch(e){this.gameCurrentIsGameOver=!0}await this.GetUserSettings(),this.gameCurrentIsGameOver||await this.RestoreCurrentGame(),this.appSettingsInfiniteMode=null===this.appSettingsInfiniteMode?this.GetModeById("infinite"):this.appSettingsInfiniteMode,this.appSettingsCurrentGameMode=null===this.appSettingsCurrentGameMode?this.GetCurrentGameMode():this.appSettingsCurrentGameMode,this.updateInterval=window.setInterval(this.UpdateApp,this.appSettingsModeIntervalIncrement),await this.GetDailyChallenge()},async HandleOnPageHideEvent(t=!0){this.appIsBeingReset||(t&&window.clearInterval(this.updateInterval),this.appSettingsSaveSettings&&(await e.SaveData("storedVersion",this.currentVersion),await e.SaveData("appSettingsModes",JSON.stringify(this.appSettingsModes)),await e.SaveData("appSettingsModeIntervalIncrement",this.appSettingsModeIntervalIncrement),await e.SaveData("appSettingsPieceSize",this.appSettingsPieceSize),await e.SaveData("appSettingsTotalNumberOfBoardPieces",this.appSettingsTotalNumberOfBoardPieces),await e.SaveData("appSettingsBoardGridSize",this.appSettingsBoardGridSize),await e.SaveData("appVisualStateShowPageHome",JSON.stringify(this.appVisualStateShowPageHome)),await e.SaveData("appVisualStateShowPageHowToPlay",JSON.stringify(this.appVisualStateShowPageHowToPlay)),await e.SaveData("appVisualStateShowPageSettings",JSON.stringify(this.appVisualStateShowPageSettings)),await e.SaveData("appVisualStateShowElementHint",JSON.stringify(this.appVisualStateShowElementHint)),await e.SaveData("appVisualStateShowElementFlyaway",JSON.stringify(this.appVisualStateShowElementFlyaway)),await e.SaveData("gameDailyChallenge",JSON.stringify(this.gameDailyChallenge)),await e.SaveData("gameCurrentIsGameDailyChallenge",JSON.stringify(this.gameCurrentIsGameDailyChallenge)),await e.SaveData("gameDailyChallengeHasBeenStarted",JSON.stringify(this.gameDailyChallengeHasBeenStarted)),await e.SaveData("gameCurrentAllLevels",JSON.stringify(this.gameCurrentAllLevels)),await e.SaveData("gameCurrentLevel",JSON.stringify(this.gameCurrentLevel)),await e.SaveData("gameCurrentIsGameOver",JSON.stringify(this.gameCurrentIsGameOver)),await e.SaveData("gameCurrentMePiece",JSON.stringify(this.gameCurrentMePiece)),await e.SaveData("gameCurrentBoardPieces",JSON.stringify(this.gameCurrentBoardPieces)),await e.SaveData("gameCurrentStartingTime",this.gameCurrentStartingTime),await e.SaveData("gameCurrentTimer",this.gameCurrentTimer),await e.SaveData("gameCurrentNumberOfClears",this.gameCurrentNumberOfClears),await e.SaveData("gameCurrentNumberOfPerfectMatches",this.gameCurrentNumberOfPerfectMatches),await e.SaveData("gameCurrentIsUserGuessWrong",JSON.stringify(this.gameCurrentIsUserGuessWrong)),await e.SaveData("gameCurrentNumberOfFails",this.gameCurrentNumberOfFails),await e.SaveData("gameCurrentNumberOfMisses",this.gameCurrentNumberOfMisses),await e.SaveData("gameCurrentHintText",this.gameCurrentHintText),await e.SaveData("gameCurrentTotalScore",this.gameCurrentTotalScore),await e.SaveData("gameCurrentHasAnyPieceEverBeenSelected",JSON.stringify(this.gameCurrentHasAnyPieceEverBeenSelected)),await e.SaveData("gameLikenessNudgeHasBeenShown",JSON.stringify(this.gameLikenessNudgeHasBeenShown)),await e.SaveData("gameClickMeNudgeHasBeenShown",JSON.stringify(this.gameClickMeNudgeHasBeenShown)),await e.SaveData("userHighScoresEasy",JSON.stringify(this.userHighScoresEasy)),await e.SaveData("userSettingsUseCats",this.userSettingsUseCats),await e.SaveData("userSettingsUseAltPatterns",this.userSettingsUseAltPatterns),await e.SaveData("userSettingsUseHints",this.userSettingsUseHints),await e.SaveData("userSettingsUseSoundFX",this.userSettingsUseSoundFX),await e.SaveData("userSettingsPlayMusic",this.userSettingsPlayMusic),await e.SaveData("userSettingsUseDarkMode",this.userSettingsUseDarkMode),await e.SaveData("userRank",this.userRank),await e.SaveData("userNumberOfPerfectBasicGames",this.userNumberOfPerfectBasicGames),this.appSettingsEnableEconomy&&(await e.SaveData("userCurrency",JSON.stringify(this.userCurrency)),await e.SaveData("userSettingsActionItems",JSON.stringify(this.userSettingsActionItems)))))},ChangeTutorialPiecesToCats(e){let t=e.replace("pieces","cats");return this.userSettingsUseCats?t:e},async HandleActionItemClick(t){if(note("HandleActionItemClick() called"),this.appSettingsEnableEconomy&&t.count>0){switch(t.count--,t.id){case 1:this.IdentifyMismatches();break;case 2:this.ResetLevel();break;case 3:this.AddTimeBonus(1e4);break;case 4:this.ClearLevel();break;case 5:this.AddTimeBonus(3e4);break;default:break}await e.SaveData("userSettingsActionItems",JSON.stringify(this.userSettingsActionItems))}},IdentifyMismatches(){note("IdentifyMismatches() called");let e=!1;this.gameCurrentBoardPieces.forEach((t=>{t.nudge=!1,!e&&(t.isMatch&&!t.isSelected||!t.isMatch&&t.isSelected)&&(t.nudge=!0,e=!0)}))},ResetLevel(){note("ResetLevel() called"),this.gameCurrentBoardPieces.forEach((e=>{e.isSelected=!1,e.nudge=!1})),this.gameCurrentNumberOfMisses=0},AddTimeBonus(e=3e3){note("AddTimeBonus() called"),this.appSettingsCurrentGameMode.bonustime=e,this.gameCurrentTimer=this.gameCurrentTimer+this.appSettingsCurrentGameMode.bonustime,this.appSettingsCurrentGameMode.bonustime>0&&(this.appVisualStateShowElementFlyaway=!0,setTimeout((()=>{this.appVisualStateShowElementFlyaway=!1}),100))},ClearLevel(){note("ClearLevel() called"),this.ResetLevel(),this.gameCurrentBoardPieces.forEach((e=>{e.isSelected=e.isMatch})),this.CheckBoard()},async AdjustItemCount(t,a,s,r){note("AdjustItemCount() called"),void 0!==t&&(t.stopPropagation(),t.preventDefault());let i=s.count+r,n=a.count+-1*s.cost*r;n>=0&&i>=0&&i<=s.maxCount&&(a.count=n,s.count=i),await e.SaveData("userCurrency",JSON.stringify(this.userCurrency)),await e.SaveData("userSettingsActionItems",JSON.stringify(this.userSettingsActionItems))},async HandleSkipTutorial(){note("HandleSkipTutorial() called"),this.userTutorialCheckCount=0,this.appTutorialIsInPlay=!1,this.appTutorialCurrentStepIndex=0,this.appTutorialUserHasSeen=!0,await e.SaveData("appTutorialUserHasSeen",!0)},HandleDoneTutorial(){note("HandleDoneTutorial() called"),this.appTutorialUserHasSeen||this.RestartGame(),this.HandleSkipTutorial()},HandleTutorialNext(){note("HandleTutorialNext() called"),this.appTutorialCurrentStepIndex++},HandleTutorialBack(){note("HandleTutorialBack() called"),this.appTutorialCurrentStepIndex>0&&this.appTutorialCurrentStepIndex--},HandleTutorialCheck(){if(note("HandleTutorialCheck() called"),this.appTutorialCurrentStepIndex>3){this.userTutorialCheckCount++;let e=!0;this.appTutorialBoardPieces.board.forEach(((t,a)=>{(a<4&&!t.isSelected||a>=4&&t.isSelected)&&(e=!1)})),e?(this.appTutorialBoardPieces.board.forEach(((e,t)=>{e.isSelected=!1})),this.HandleTutorialNext()):(this.userTutorialCheckCount>2&&this.appTutorialBoardPieces.board.forEach(((e,t)=>{e.isSelected=e.isMatch})),this.gameCurrentIsUserGuessWrong=!0,window.setTimeout((function(){t.gameCurrentIsUserGuessWrong=!1}),500))}log("this.userTutorialCheckCount = "+this.userTutorialCheckCount)},HandleOnPageShowEvent(){note("HandleOnPageShowEvent() called"),this.appVisualStateShowGameOverContent=!0,this.appSettingsInfiniteMode=null===this.appSettingsInfiniteMode?this.GetModeById("infinite"):this.appSettingsInfiniteMode,this.appSettingsCurrentGameMode=null===this.appSettingsCurrentGameMode?this.GetCurrentGameMode():this.appSettingsCurrentGameMode,window.clearInterval(this.updateInterval),this.updateInterval=window.setInterval(this.UpdateApp,this.appSettingsModeIntervalIncrement),this.GetDailyChallenge(),this.CheckForServiceWorkerUpdate()},HandleTouchApp(){note("HandleTouchApp() called"),this.appSettingsThemeSong.playing()||"loaded"!==this.appSettingsThemeSong.state()||this.appTutorialIsInPlay||!this.userSettingsPlayMusic||(this.appSettingsThemeSong.volume(0),this.appSettingsThemeSong.play(),this.appSettingsThemeSong.fade(0,this.userSettingsMusicVolume,1e3))},CheckForServiceWorkerUpdate(){note("CheckForServiceWorkerUpdate() called"),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then((function(e){for(let t of e)t.update()}))},HandleOnVisibilityChange(e){if(note("HandleOnVisibilityChange() called"),this.appVisualStateShowGameOverContent=!0,this.HandleOnPageHideEvent(),document.hidden)this.userSettingsPlayMusic&&this.appSettingsThemeSong.fade(this.userSettingsMusicVolume,0,1e3),this.splashBoard&&(this.splashBoard=!1,this.EndGame(),this.HandleOnResizeEvent());else{log("document visible");const{ctx:e}=Howler;e&&!document.hidden&&setTimeout((()=>{e.resume()}),100),this.userSettingsPlayMusic&&this.appSettingsThemeSong.fade(0,this.userSettingsMusicVolume,1e3)}this.GetDailyChallenge(),this.CheckForServiceWorkerUpdate(),window.clearInterval(this.updateInterval),this.updateInterval=window.setInterval(this.UpdateApp,this.appSettingsModeIntervalIncrement)},AdjustPieceSizeBasedOnViewport(){this.splashBoard||(this.appSettingsPieceSize=window.innerWidth<450?(window.innerWidth-60)/this.appSettingsBoardGridSize+"px":400/this.appSettingsBoardGridSize+"px",this.documentCssRoot.style.setProperty("--pieceSize",this.appSettingsPieceSize),this.appSettingsTotalNumberOfBoardPieces=window.innerHeight<234?12:16)},async GetDailyChallenge(){note("GetDailyChallenge() 2 called");let t=new Date;if(!this.gameCurrentIsGameDailyChallenge&&(0===this.gameDailyChallenge.allLevels.length||this.GetMonthAndDay(this.gameDailyChallenge.date)!==this.GetMonthAndDay(t))){this.gameDailyChallenge=new e.AllLevelsModel({});let a=parseInt(t.toLocaleDateString("en-UK").replace(/\//g,""));e.ConstructAllLevels(this.GenerateNumbers(a),this.gameDailyChallenge)}this.CheckIfUserHasScoredDailyChallenge()},GenerateNumbers(e){for(var t=new Math.seedrandom(e),a=[],s=0;s<parseInt(this.getCurrentPlayerRank.levels);s++){for(var r="",i=0;i<51;i++){r+=(i%3==2?Math.floor(4*t())+1:Math.floor(3*t())+1).toString()}a+=r}return a},FillBoardWithPieces(t=this.appSettingsPieceSize){if(note("FillBoardWithPieces() called"),UseDebug){let a=this.GenerateNumbers();this.HandleSkipTutorial(),this.SelectMode(this.getInfiniteModeComputed),this.RestartGame(),this.documentCssRoot.style.setProperty("--pieceSize",t);let s=e.ConstructLevel(a,!0);this.gameCurrentBoardPieces=s.board,this.splashBoard=!0}},StartDailyChallenge(){note("StartDailyChallenge() called"),this.usersModeBeforeDailyChallenge=this.getCurrentGameModeComputed,this.SelectMode(this.GetModeById("normal")),this.gameDailyChallengeHasBeenStarted=!0,this.gameCurrentIsGameDailyChallenge=!0,this.RestartGame()},HandleOnResizeEvent(){this.AdjustPieceSizeBasedOnViewport()},FormatDate:e=>new Date(e).toLocaleDateString(),GetMonthAndDay(e){const t=new Date(e);return`${t.toLocaleString("default",{month:"short"})} ${t.getDate()}`},NumberWithCommas:e=>e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),CheckForMobile(){let e="ontouchstart"in document.documentElement;return this.deviceHasTouch=e,e},HandleKeyUp(e){note("HandleKeyUp(event) called");let t=-1;switch(this.appSettingsThemes.forEach(((e,a)=>{e.isSelected&&(t=a)})),e.key){case"]":t=t==this.appSettingsThemes.length-1?0:t+1,this.SelectTheme(this.appSettingsThemes[t]);break;case"[":t=0==t?this.appSettingsThemes.length-1:t-1,this.SelectTheme(this.appSettingsThemes[t]);break;case"/":this.ToggleUsingDarkMode();break;case"c":this.ToggleUsingCats();break;case"p":this.ToggleUsingAltPattern();break;case"1":case"2":case"3":case"4":break;case" ":case"Enter":e.preventDefault(),this.appTutorialIsInPlay||this.gameCurrentIsGameOver||this.appVisualStateShowPageChallenge?!this.gameCurrentIsGameOver&&this.appVisualStateShowPageChallenge?this.EndGame():this.appTutorialIsInPlay&&(this.appTutorialCurrentStepIndex<this.appTutorialSteps.length-1?this.HandleTutorialNext():this.gameCurrentIsGameOver&&this.HandleSkipTutorial()):this.CheckBoard();break;case"Escape":this.ClearEphemeralVisualStates();break}},HandleKeyDown(e){switch(e.key){case" ":case"Enter":e.preventDefault();break}},ClearEphemeralVisualStates(){note("ClearEphemeralVisualStates() called"),this.RemoveConfetti(),this.gameConfettiCount=0,this.appVisualStateShowNotification=!1,this.appVisualStateShowElementHint=!1,this.appVisualStateShowPageManageCurrency=!1,this.tempPerfectBasicGames=this.userNumberOfPerfectBasicGames,this.gameCurrentIsGameOver&&(this.appVisualStateShowPageHome=!0),this.appTutorialIsInPlay&&this.HandleSkipTutorial(),this.appVisualStateShowGameOverContent=!0,this.appVisualStateShowPageSettings=!1,this.appVisualStateShowPageHighScores=!1,this.appVisualStateShowPageAchievements=!1,this.appVisualStateShowPageHowToPlay=!1,this.appVisualStateShowPageCredits=!1,this.appVisualStateShowPageChallenge=!1,this.appVisualStateShowElementHint=!1,this.appVisualStateShowPageGameOver=!1},HandleUpdateAppButtonClick(){note("HandleUpdateAppButtonClick() called"),this.newVersionAvailable=!1,navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({action:"skipWaiting"}),window.location.reload(!0)},HandleServiceWorkerRegistration(){note("HandleServiceWorkerRegistration() called"),this.newVersionAvailable=!1,"serviceWorker"in navigator?navigator.serviceWorker.register("/sw.js",{scope:"/",updateViaCache:"none"}).then((e=>(note("Service worker registered with scope: "+e.scope),navigator.serviceWorker.ready))).then((()=>{note("Service worker is active and controlling the page.")})).catch((e=>{error(`Service worker registration failed: ${e.message}`)})):error("Service workers are not supported in this browser.")}},async mounted(){highlight(`App version ${version} initiated`,!0),this.appVisualStateIsLoading=!0,UseDebug=-1!=document.location.href.indexOf("local")||-1!=document.location.href.indexOf("debug=true"),this.HandleServiceWorkerRegistration(),await this.InitializeGame(),window.addEventListener("keyup",this.HandleKeyUp),window.addEventListener("keydown",this.HandleKeyDown),window.addEventListener("pageshow",this.HandleOnPageShowEvent),window.addEventListener("visibilitychange",this.HandleOnVisibilityChange),window.addEventListener("pagehide",this.HandleOnPageHideEvent),window.addEventListener("resize",this.HandleOnResizeEvent),void 0!==navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",(e=>{"updateAvailable"===e.data&&""!==this.serviceWorker&&this.serviceWorker.postMessage({action:"skipWaiting"})})),navigator.serviceWorker.addEventListener("controllerchange",(()=>{this.newVersionAvailable=!0})),this.appVisualStateIsLoading=!1},beforeUnmount(){window.removeEventListener("keyup",this.HandleKeyUp),window.removeEventListener("keydown",this.HandleKeyDown),window.removeEventListener("pageshow",this.HandleOnPageShowEvent),window.removeEventListener("visibilitychange",this.HandleOnVisibilityChange),window.removeEventListener("pagehide",this.HandleOnPageHideEvent),window.removeEventListener("resize",this.HandleOnResizeEvent)},computed:{userScoresHighEasyByValue:function(){return note("userScoresHighEasyByValue() called"),this.userHighScoresEasy.filter((e=>!e.isDaily)).sort((function(e,t){return e.value<t.value?1:e.value>t.value?-1:0})).flat().slice(0,this.appSettingsNumberOfHighScoresShown)},userScoresHighDailyByDate:function(){return note("userScoresHighDailyByDate() called"),this.userHighScoresEasy.filter((e=>e.isDaily)).sort((function(e,t){return e.date<t.date?1:e.date>t.date?-1:0})).flat().slice(0,this.appSettingsNumberOfHighScoresShown)},userScoresHighInfiniteByValue:function(){return note("userScoresHighInfiniteByValue() called"),this.userHighScoresInfinite.sort((function(e,t){return e.value<t.value?1:e.value>t.value?-1:0})).flat().slice(0,this.appSettingsNumberOfHighScoresShown)},userScoresHighDailyByValue:function(){return note("userScoresHighDailyByValue() called"),this.userHighScoresEasy.filter((e=>e.isDaily)).sort((function(e,t){return e.value<t.value?1:e.value>t.value?-1:0})).flat().slice(0,this.appSettingsNumberOfHighScoresShown)},userHasDoneTodaysDailyChallenge:function(){const e=(new Date).toDateString();return this.userHighScoresEasy.some((t=>new Date(t.dailyDate).toDateString()===e&&t.isDaily))},getCurrentGameModeComputed:function(){return note("getCurrentGameModeComputed() called"),this.GetCurrentGameMode()},getInfiniteModeComputed:function(){return note("getInfiniteModeComputed() called"),this.GetModeById("infinite")},getNormalModeComputed:function(){return note("getNormalModeComputed() called"),this.GetModeById("normal")},getCurrentPlayerRank:function(){return note("getCurrentPlayerRank() called"),this.allPlayerRanks.find((e=>e.rank===this.userRank))},getLastHighScoreRank:function(){return note("getLastHighScoreRank() called"),this.GetRankById(this.gameLastHighScore.rankId)},getNextPlayerRank:function(){return note("getNextPlayerRank() called"),this.allPlayerRanks.find((e=>e.rank===parseInt(this.userRank+1)))},getLastRank:function(){return note("getLastRank() called"),this.allPlayerRanks[this.allPlayerRanks.length-1]},getGameOverTitle:function(){note("getGameOverTitle() called");let e="";return this.getNormalModeComputed.isSelected?(e="Game over",this.gameLastHighScore.numberOfPerfectClears===this.gameLastHighScore.totalPossibleClears&&(e="Perfect!",this.gameCurrentJustRankedUp&&this.userNumberOfPerfectBasicGames<3&&(e="<span class='ranktext'>"+this.getCurrentPlayerRank.name+" Unlocked!!</span>"))):e=this.gameLastHighScore.numberOfClears>0?"Success":"No worry",e},getGameOverSubtitle:function(){note("getGameOverSubtitle() called");let e="";return this.getNormalModeComputed.isSelected?this.gameLastHighScore.isDaily&&!this.appVisualStateShowNewHighScoreElement?e="Daily - "+this.GetMonthAndDay(this.gameLastHighScore.dailyDate):!this.userSettingsUseHardCoreMode&&this.userNumberOfPerfectBasicGames>=3?e="Hardcore Mode Unlocked!":this.gameLastHighScore.isDaily||this.appVisualStateShowNewHighScoreElement||(e=this.gameLastHighScore.numberOfPerfectClears===this.gameLastHighScore.totalPossibleClears?"Very nicely done.":"Better luck next time!"):e=this.gameLastHighScore.numberOfClears>0?"You are present and connected.":"There will always be time.",e},getHomePageRankSubcredit:function(){note("getHomePageRankSubcredit() called");let e="";return!this.userSettingsUseHardCoreMode&&this.userNumberOfPerfectBasicGames<3&&void 0!==this.getNextPlayerRank?e="Next rank: &rdquo;"+this.getNextPlayerRank.name+"&ldquo;":!this.userSettingsUseHardCoreMode&&this.userNumberOfPerfectBasicGames<3&&void 0===this.getNextPlayerRank?e="The next rank is a mystery!":!this.userSettingsUseHardCoreMode&&this.userNumberOfPerfectBasicGames>=3?e="Hardcore Mode Unlocked!":this.userSettingsUseHardCoreMode&&this.userNumberOfPerfectBasicGames<3&&void 0!==this.getNextPlayerRank&&(e="Next Hardcore rank: &rdquo;"+this.getNextPlayerRank.name+"&ldquo;"),e},getRankPageSubcredt:function(){note("getRankPageSubcredt() called");let e="";return!this.userSettingsUseHardCoreMode&&this.userNumberOfPerfectBasicGames<3?e="Get 3 perfect games to unlock the next rank. Perfect games are only earned when every level in that game is cleared on the <b>first</b> attempt.":!this.userSettingsUseHardCoreMode&&this.userRank===this.getLastRank.rank&&this.userNumberOfPerfectBasicGames>=3?e="Amazing! You've done at least 3 perfect games as a <b>"+this.getLastRank.name+"</b> But if you truly want a challenge, enable Hardcore mode and start over.":this.userSettingsUseHardCoreMode&&this.userRank<this.getLastRank.rank?e="Get 3 perfect games in a row to unlock the next rank. Perfect games are only earned when every level in that game is cleared on the <b>first</b> attempt.":this.userSettingsUseHardCoreMode&&this.userRank===this.getLastRank.rank&&this.userNumberOfPerfectBasicGames<3?e="Wow! It takes some serious skill to achieve the <b>"+this.getLastRank.name+"</b> rank while in Hardcore Mode.":this.userSettingsUseHardCoreMode&&this.userRank===this.getLastRank.rank&&this.userNumberOfPerfectBasicGames>=3&&(e=this.appSettingsHardcoreFinishedEmoji+" You are beyond impressive: <br /><b>"+this.getLastRank.name+"</b> rank while in Hardcore Mode with at least 3 consecutive perfect games. <br />They should sing songs about you!"),e},getNextRankRequirementsText:function(){note("getRankPageSubcredt() called");let e="";return this.userRank!==this.getLastRank.rank?e="Just "+(3-this.userNumberOfPerfectBasicGames)+" more perfect "+(2===this.userNumberOfPerfectBasicGames?"game":"games")+" till the next Rank":!this.userSettingsUseHardCoreMode&&this.userRank===this.getLastRank.rank&&this.userNumberOfPerfectBasicGames<3&&(e="Just "+(3-this.userNumberOfPerfectBasicGames)+" more perfect "+(2===this.userNumberOfPerfectBasicGames?"game":"games")),e},enabledCurrencies:function(){return note("enabledCurrencies() called"),this.userCurrency.filter((e=>e.isEnabled))},getFirstTwoItemsSortedByOrder:function(){return note("getFirstTwoItemsSortedByOrder() called"),[this.userSettingsActionItems[0],this.userSettingsActionItems[1]]},getSecondTwoItemsSortedByOrder:function(){return note("getSecondTwoItemsSortedByOrder() called"),[this.userSettingsActionItems[2],this.userSettingsActionItems[3]]},getItemsSortedByCost:function(){return note("getItemsSortedByCost() called"),this.userSettingsActionItems.sort((function(e,t){return e.cost>t.cost?1:e.cost<t.cost?-1:0}))},allPlayerRanksBelowOrEqualToCurrentPlayerRank:function(){return note("allPlayerRanksBelowOrEqualToCurrentPlayerRank() called"),this.allPlayerRanks.filter((e=>e.rank<=this.userRank))},allPlayerRanksAboveCurrentPlayerRank:function(){return note("allPlayerRanksAboveCurrentPlayerRank() called"),this.allPlayerRanks.filter((e=>e.rank>this.userRank))}}});t.config.compilerOptions.isCustomElement=e=>["app","tutorial","oobe","wallpaper","home","modes","mode","piece","glyph","gild","value","checkbox","toggle","version","howto","icon","chrome","quit","divider","stage","gameover","clears","time","playarea","addtime","board","me","puzzle","hint"].includes(e),window.app=t.mount("#app")}));